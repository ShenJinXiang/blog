<!doctype html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<meta content="yes" name="apple-mobile-web-app-capable">
	<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
	<meta content="telephone=no" name="format-detection">
	<meta name="keywords" content="LiksStar ShenJinXiang 申锦祥 demo canvas 博客 钟表">
	<meta name="description" content="LiksStar ShenJinXiang 申锦祥 demo canvas 博客 钟表">
	<link rel='icon' href="../../../images/title.ico" type="image/x-ico" />
	<link rel="stylesheet" href="../../../plugin/prism/prism.css">
	<link rel="stylesheet" href="../../../css/style.css">
	<title>LikeStar</title>
</head>
<body>
<div id="temp_content" style="display: none;">
	<div class="post-content">
<!-- 正文开始 -->
<p>之前用html+css+JavaScript实现了一个简单钟表，但还是有一些问题，主要是一些css属性不同浏览器支持效果不一样，所以尝试用canvas实现了一个简单的钟表，效果在下方，当然了，采用canvas同样会有一些浏览器不支持。。。 这里只讨论canvas的实现方式。</p>
<iframe src='clock.html' frameborder='0' height='450px' width='100%' scrolling='no'></iframe>
<h3>html部分</h3>
<p>html部分很简单，写入canvas标签，其id设置为“canvas”，用css设置成居中显示，代码如下：</p>
<pre class='line-numbers language-html'>
<code>
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;meta charset='utf-8'&gt;
	&lt;style&gt;
	canvas{display:block;margin:5px auto;}
	&lt;/style&gt;
	&lt;title&gt;clock&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;canvas id='canvas'&gt;&lt;/canvas&gt;
&lt;script type='text/javascript' src="外部JavaScript文件路径"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code>
</pre>
<p>备注：需要通过script标签的src属性引入外部JavaScript文件</p>
<br><hr><br>
<h3>JavaScript部分</h3>
<p>可以通过js获取Canvas对象，设置画布的宽高，不过绘图工作是通过操作CanvasRenderingContext2D对象来操作的，获取此对象的方法：</p>
<pre class='line-numbers language-javascript'>
<code>
var canvas = document.getElementById('canvas');	// Canvas对象
canvas.width = 450;		// 宽
canvas.height = 450;	// 高
var context = canvas.getContext('2d'); // 获取绘图上下文环境
</code>
</pre>
<p>获取到绘图上下文context以后即可绘制钟表了，整体思路是这样的：定义一个全局变量记录当前系统时间信息，用setInterval方法重复执行，获取时间信息，并绘制图像，代码如下：</p>
<pre class='line-numbers language-javascript'>
<code>
var currentDateObj; // 记录当前时间信息
setInterval(function(){
	update(); // 修改currentDateObj的内容
	draw(); // 根据currentDateObj的内容绘制图像
}, 500);
</code>
</pre>
<p>本文实现重点在于绘制图像，关于update方法的实现，可以直接查看后边的整体js代码，draw方法中，主要涉及到的一些内容有：线段和圆的绘制、canvas文字渲染、canvas阴影实现、canvas图形变换等内容</p>
<h4>canvas绘制线段、圆</h4>
<p>绘制线段很简单，只需调用moveTo、lineTo方法设置线段路径，调用stroke方法完成绘制</p>
<pre class='line-numbers language-javascript'>
<code>
context.moveTo(20, 70);
context.lineTo(140, 70);
context.lineTo(140, 40);
context.lineTo(180, 80);
context.lineTo(140, 120);
context.lineTo(140, 90);
context.lineTo(20, 90);
context.lineWidth = 2; // 设置线段宽度
context.strokeStyle = "#058"; // 设置颜色
context.stroke();	// 绘制到画布上
</code>
</pre>
<p>运行结果：</p>
<iframe src='test1.html' frameborder='0' height='200px' width='100%' scrolling='no'></iframe>
<p>绘制圆需要调用arc方法，然后调用stroke完成绘制，arc有5个参数，分别表示圆弧圆心的x坐标、y坐标、圆弧半径、起始角、结束角，最后一个参数是一个布尔值，false表示顺时针，true表示逆时针，下面是一些示例</p>
<pre class='line-numbers language-javascript'>
<code>
for(var i = 0; i &lt; 2; i++) {
	for(var j = 0; j &lt; 4; j++){
		var b = (i == 0) ? false : true;
		context.beginPath();
		context.lineWidth = 2;
		context.strokeStyle = '#058';
		context.arc(150 * j + 75, 150 * i + 75, 45, 0, (j + 1) * Math.PI / 2, b);
		context.stroke();
	}
}
</code>
</pre>
<p>运行结果：</p>
<iframe src='test2.html' frameborder='0' height='420px' width='100%' scrolling='no'></iframe>
<p>通过moveTo、lineTo或者arc方法设置好图形路径以后，调用stroke方法完成图形绘制，如果需要绘制一个区域，需要调用fill方法，如上例中，可以将stroke改成fill代码如下：</p>
<pre class='line-numbers language-javascript'>
<code>
for(var i = 0; i &lt; 2; i++) {
	for(var j = 0; j &lt; 4; j++){
		var b = (i == 0) ? false : true;
		context.beginPath();
		context.fillStyle = '#058';
		context.arc(150 * j + 75, 150 * i + 75, 45, 0, (j + 1) * Math.PI / 2, b);
		context.fill();
	}
}
</code>
</pre>
<p>运行结果如下：</p>
<iframe src='test3.html' frameborder='0' height='420px' width='100%' scrolling='no'></iframe>
<h4>canvas文字渲染</h4>
<p>在canvas画布上写段文字很简单，基本分两步：1.通过设置context的font属性设置文本的样式；2. 调用fillText或strokeText方法渲染文字</p>
<pre class='line-numbers language-javascript'>
<code>
context.font = "bold 40px Arial";
context.fillStyle = '#058';
context.fillText("Canvas制作简单钟表", 50, 50);
context.strokeStyle = '#058';
context.strokeText("Canvas制作简单钟表", 50, 150);
</code>
</pre>
<p>运行结果如下：</p>
<iframe src='test4.html' frameborder='0' height='220px' width='100%' scrolling='no'></iframe>
<p>可以设置textAlign和textBaseline属性分别设置文本水平和垂直方向的对齐方式</p>
<h4>clearRect方法</h4>
<p>clearRect方法用于清空一个矩形空间站的图像，语法为：context.clearRect(x, y, width, height); 第一个参数x 表示要清除的矩形左上角的x坐标，第二个参数y 表示要清除的矩形左上角的y坐标，width参数表示要清除的矩形的宽度，height参数表示要清除的矩形的高度。</p>
<p>在本文中，draw方法的第一步就是调用此方法，清空整个canvas画布的内容，然后才根据currentDateObj中的内容绘制图像。</p>
<!-- 正文结束 -->
	</div>
</div>
<script src="../../../plugin/jquery/jquery.js"></script>
<script src="../../../plugin/prism/prism.js"></script>
<script src="../../../js/main.js"></script>
<script><!--{{{-->
$(function(){
	LS.init({
		'currentMenu' : 1,
		'sidebar' : ['date', 'category', 'tags', 'post'],
		'content' : {
			'type' : 'post',
			'id' : 12
		}
	});

});
</script><!--}}}-->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript"><!--{{{-->
var duoshuoQuery = {short_name:"shenjinxiang"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script><!--}}}-->
<!-- 多说公共JS代码 end -->
</body>
</html>


